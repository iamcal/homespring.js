/*! homespring.js 2016-11-27 */
var HS={};HS["const"]={YOUNG:1,MATURE:2,UPSTREAM:3,DOWNSTREAM:4},HS.Exception=function(a){this.message=a,this.name="HS.Exception"},HS.Program=function(a,b){var c=this;return c.debugMode=!!b,c.tokens=c.tokenize(a),c.tree=c.build_tree(c.tokens),c.tickNum=0,c.endThisTick=!1,c},HS.Program.prototype.build_tree=function(a){if(!a.length)return null;for(var b=1,c=new HS.Node((b++),a[0]),d=c,e=[c],f=1;f<a.length;f++)if(""==a[f]){if(d=d.parent,!d)throw new HS.Exception("Illegal program - traversed beyond root")}else{var g=new HS.Node((b++),a[f],d);e.push(g),d=g}return{root:c,nodes:e}},HS.Program.prototype.reservedList={hatchery:1,"hydro power":1,snowmelt:1,shallows:1,rapids:1,"append down":1,bear:1,"force field":1,sense:1,clone:1,"young bear":1,bird:1,"upstream killing device":1,waterfall:1,universe:1,powers:1,marshy:1,insulated:1,"upstream sense":1,"downstream sense":1,evaporates:1,"youth fountain":1,oblivion:1,pump:1,"range sense":1,fear:1,"reverse up":1,"reverse down":1,time:1,lock:1,"inverse lock":1,"young sense":1,"switch":1,"young switch":1,narrows:1,"append up":1,"young range sense":1,net:1,"force down":1,"force up":1,spawn:1,"power invert":1,current:1,bridge:1,split:1,"range switch":1,"young range switch":1},HS.Node=function(a,b,c){var d=this;return d.uid=a,d.name=b,d.lname=b.toLowerCase(),d.parent=c,d.kids=[],d.salmon=[],c&&c.kids.push(d),d.is_snowy=null,d.is_watered=null,d.generates_power=null,d.prev_snow=!1,d.was_bridge=!1,d},HS.Node.prototype.isSpring=function(){var a=this;return!HS.Program.prototype.reservedList[a.lname]},HS.Node.prototype.isPowered=function(){var a=this;if(a.generates_power)return!0;var b=a.lname;if("insulated"==b)return!1;if("upstream sense"==b&&a.hasMatureUpstreamSalmon())return!1;if("downstream sense"==b&&a.hasMatureDownstreamSalmon())return!1;if("sense"==b&&a.hasMatureSalmon())return!1;if("young sense"==b&&a.hasYoungSalmon())return!1;if("range sense"==b&&(a.hasMatureSalmon()||a.hasMatureSalmonUpstream()))return!1;if("young range sense"==b&&(a.hasYoungSalmon()||a.hasYoungSalmonUpstream()))return!1;if("switch"==b&&!a.hasMatureSalmon())return!1;if("young switch"==b&&!a.hasYoungSalmon())return!1;if("range switch"==b&&!a.hasMatureSalmon()&&!a.hasMatureSalmonUpstream())return!1;if("young range switch"==b&&!a.hasYoungSalmon()&&!a.hasYoungSalmonUpstream())return!1;if("power invert"==b){for(var c=0;c<a.kids;c++)if(a.kids[c].isPowered())return!1;return!0}for(var c=0;c<a.kids.length;c++)if(a.kids[c].isPowered())return!0;return!1},HS.Salmon=function(){var a=this;return a.name=name,a.age=null,a.direction=null,a},HS.Program.prototype.debug=function(a){var b=this;b.debugMode&&console.log(a)},HS.Program.prototype.tokenize=function(a){var b=this;if(a.indexOf("\t")>=0)throw new HS.Exception("Illegal program - contains tabs");if(a.indexOf(" . ")>=0)throw new HS.Exception("Illegal program - contains space-dot-space");if(a.indexOf(". .")>=0)throw new HS.Exception("Illegal program - contains dot-space-dot");for(var c=[],d=a.split(""),e="",f=d.length,g=0;g<f;g++)if(" "==d[g])"."==d[g+1]?(e+=".",g++):(c.push(e),e="");else if("\n"==d[g])c.push(e),e="";else if("."==d[g])if(" "==d[g+1])e+=" ",g++;else{if("\n"!=d[g+1])return b.debug("parser error - unexpected period followewd by "+d[g+1]),[];e+="\n",c.push(e),e="",g++}else e+=d[g];return e.length&&c.push(e),c},HS.Program.prototype.tick=function(){var a=this;a.tickNum++,a.snowTick(),a.waterTick(),a.powerTick(),a.fishTick(),a.miscTick(),a.inputTick()},HS.Program.prototype.snowTick=function(){var a=this;a.debug("starting snow tick #"+a.tickNum);for(var b={"hydro power":1,universe:1,oblivion:1,"power invert":1,bridge:1},c=a.tree.nodes.length-1;c>=0;c--){var d=a.tree.nodes[c],e=d.lname;if("snowmelt"!=e){for(var f=!1,g=0;g<d.kids.length;g++)if(d.kids[g].is_snowy){f=!0;break}"marshy"!=e?f&&("force field"!=e&&"evaporates"!=e&&"lock"!=e||!d.is_powered)&&("inverse lock"!=e||d.is_powered)?""==e&&d.was_bridge?d.is_snowy=!1:(d.is_snowy=!0,"universe"==e&&(a.endThisTick=!0),"bridge"==e&&(d.was_bridge=!0),b[e]&&(d.old_name=d.name,d.old_lname=d.lname,d.name="",d.lname="")):d.is_snowy=!1:(d.is_snowy=d.prev_snow,d.prev_snow=f)}else d.is_snowy=!0}},HS.Program.prototype.waterTick=function(){var a=this;a.debug("starting water tick #"+a.tickNum);for(var b=a.tree.nodes.length-1;b>=0;b--){var c=a.tree.nodes[b],d=c.lname;if(c.isSpring())c.is_watered=!0;else{for(var e=!1,f=0;f<c.kids.length;f++)if(c.kids[f].is_watered){e=!0;break}e&&("force field"!=d&&"evaporates"!=d||!c.is_powered)?""==d&&c.was_bridge?c.is_watered=!1:c.is_watered=!0:c.is_watered=!1}}},HS.Program.prototype.powerTick=function(){var a=this;a.debug("starting power tick #"+a.tickNum);for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b],d=c.lname;c.generates_power=!1,"hydro power"!=d?"powers"!=d||(c.generates_power=!0):c.is_watered&&(c.generates_power=!0)}},HS.Program.prototype.fishTick=function(){var a=this;a.debug("starting fish tick #"+a.tickNum)},HS.Program.prototype.miscTick=function(){var a=this;a.debug("starting misc tick #"+a.tickNum),a.endThisTick&&a.debug("program exits!")},HS.Program.prototype.inputTick=function(){var a=this;a.debug("starting input tick #"+a.tickNum)},HS.Program.prototype.tickSnow=function(){var a=this;a.tick();for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b];"marshy"==c.name?a.debug(c.name+" -> "+(c.is_snowy?"YES":"-")+(c.prev_snow?" / (YES)":" / (-)")):a.debug(c.name+" -> "+(c.is_snowy?"YES":"-"))}},HS.Program.prototype.tickWater=function(){var a=this;a.tick();for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b];a.debug(c.name+" -> "+(c.is_watered?"YES":"-"))}};