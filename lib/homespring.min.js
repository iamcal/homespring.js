/*! homespring.js 2016-10-18 */
var HS={};HS.Exception=function(a){this.message=a,this.name="HS.Exception"},HS.Program=function(a){var b=this;return b.tokens=b.tokenize(a),b.tree=b.build_tree(b.tokens),b.tickNum=0,b.endThisTick=!1,b},HS.Program.prototype.build_tree=function(a){if(!a.length)return null;for(var b=1,c=new HS.Node((b++),a[0]),d=c,e=[c],f=1;f<a.length;f++)if(""==a[f]){if(d=d.parent,!d)return console.log("invalid program - traversed beyond start"),null}else{var g=new HS.Node((b++),a[f],d);e.push(g),d=g}return{root:c,nodes:e}},HS.Program.prototype.reservedList={hatchery:1,"hydro power":1,snowmelt:1,shallows:1,rapids:1,"append down":1,bear:1,"force field":1,sense:1,clone:1,"young bear":1,bird:1,"upstream killing device":1,waterfall:1,universe:1,powers:1,marshy:1,insulated:1,"upstream sense":1,"downstream sense":1,evaporates:1,"youth fountain":1,oblivion:1,pump:1,"range sense":1,fear:1,"reverse up":1,"reverse down":1,time:1,lock:1,"inverse lock":1,"young sense":1,"switch":1,"young switch":1,narrows:1,"append up":1,"young range sense":1,net:1,"force down":1,"force up":1,spawn:1,"power invert":1,current:1,bridge:1,split:1,"range switch":1,"young range switch":1},HS.Node=function(a,b,c){var d=this;return d.uid=a,d.name=b,d.parent=c,d.kids=[],c&&c.kids.push(d),d.is_snowy=null,d.is_watered=null,d.generates_power=null,d.prev_snow=!1,d.was_bridge=!1,d},HS.Node.prototype.isSpring=function(){var a=this;return!HS.Program.prototype.reservedList[a.name.toLowerCase()]},HS.Node.prototype.isPowered=function(){var a=this;if(a.generates_power)return!0;var b=a.name.toLowerCase();if("insulated"==b)return!1;if("upstream sense"==b&&a.hasMatureUpstreamSalmon())return!1;if("downstream sense"==b&&a.hasMatureDownstreamSalmon())return!1;if("sense"==b&&a.hasMatureSalmon())return!1;if("young sense"==b&&a.hasYoungSalmon())return!1;if("range sense"==b&&(a.hasMatureSalmon()||a.hasMatureSalmonUpstream()))return!1;if("young range sense"==b&&(a.hasYoungSalmon()||a.hasYoungSalmonUpstream()))return!1;if("switch"==b&&!a.hasMatureSalmon())return!1;if("young switch"==b&&!a.hasYoungSalmon())return!1;if("range switch"==b&&!a.hasMatureSalmon()&&!a.hasMatureSalmonUpstream())return!1;if("young range switch"==b&&!a.hasYoungSalmon()&&!a.hasYoungSalmonUpstream())return!1;if("power invert"==b){for(var c=0;c<a.kids;c++)if(a.kids[c].isPowered())return!1;return!0}for(var c=0;c<a.kids.length;c++)if(a.kids[c].isPowered())return!0;return!1},HS.Salmon=function(){var a=this;return a.name=name,a.age=null,a.direction=null,a},HS.Program.prototype.tokenize=function(a){if(a.indexOf("\t")>=0)throw new HS.Exception("Illegal program - contains tabs");if(a.indexOf(" . ")>=0)throw new HS.Exception("Illegal program - contains space-dot-space");if(a.indexOf(". .")>=0)throw new HS.Exception("Illegal program - contains dot-space-dot");for(var b=[],c=a.split(""),d="",e=c.length,f=0;f<e;f++)if(" "==c[f])"."==c[f+1]?(d+=".",f++):(b.push(d),d="");else if("\n"==c[f])b.push(d),d="";else if("."==c[f])if(" "==c[f+1])d+=" ",f++;else{if("\n"!=c[f+1])return console.log("parser error - unexpected period followewd by "+c[f+1]),[];d+="\n",b.push(d),d="",f++}else d+=c[f];return d.length&&b.push(d),b},HS.Program.prototype.tick=function(){var a=this;a.tickNum++,a.snowTick(),a.waterTick(),a.powerTick(),a.fishTick(),a.miscTick(),a.inputTick()},HS.Program.prototype.snowTick=function(){var a=this;console.log("starting snow tick #"+a.tickNum);for(var b={"hydro power":1,universe:1,oblivion:1,"power invert":1,bridge:1},c=a.tree.nodes.length-1;c>=0;c--){var d=a.tree.nodes[c],e=d.name.toLowerCase();if("snowmelt"!=e){for(var f=!1,g=0;g<d.kids.length;g++)if(d.kids[g].is_snowy){f=!0;break}"marshy"!=e?f&&("force field"!=e&&"evaporates"!=e&&"lock"!=e||!d.is_powered)&&("inverse lock"!=e||d.is_powered)?""==e&&d.was_bridge?d.is_snowy=!1:(d.is_snowy=!0,"universe"==e&&(a.endThisTick=!0),"bridge"==e&&(d.was_bridge=!0),b[e]&&(d.name="")):d.is_snowy=!1:(d.is_snowy=d.prev_snow,d.prev_snow=f)}else d.is_snowy=!0}},HS.Program.prototype.waterTick=function(){var a=this;console.log("starting water tick #"+a.tickNum);for(var b=a.tree.nodes.length-1;b>=0;b--){var c=a.tree.nodes[b],d=c.name.toLowerCase();if(c.isSpring())c.is_watered=!0;else{for(var e=!1,f=0;f<c.kids.length;f++)if(c.kids[f].is_watered){e=!0;break}e&&("force field"!=d&&"evaporates"!=d||!c.is_powered)?""==d&&c.was_bridge?c.is_watered=!1:c.is_watered=!0:c.is_watered=!1}}},HS.Program.prototype.powerTick=function(){var a=this;console.log("starting power tick #"+a.tickNum);for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b],d=c.name.toLowerCase();c.generates_power=!1,"hydro power"!=d?"powers"!=d||(c.generates_power=!0):c.is_watered&&(c.generates_power=!0)}},HS.Program.prototype.fishTick=function(){var a=this;console.log("starting fish tick #"+a.tickNum)},HS.Program.prototype.miscTick=function(){var a=this;console.log("starting misc tick #"+a.tickNum),a.endThisTick&&console.log("program exits!")},HS.Program.prototype.inputTick=function(){var a=this;console.log("starting input tick #"+a.tickNum)},HS.Program.prototype.tickSnow=function(){var a=this;a.tick();for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b];"marshy"==c.name?console.log(c.name+" -> "+(c.is_snowy?"YES":"-")+(c.prev_snow?" / (YES)":" / (-)")):console.log(c.name+" -> "+(c.is_snowy?"YES":"-"))}},HS.Program.prototype.tickWater=function(){var a=this;a.tick();for(var b=0;b<a.tree.nodes.length;b++){var c=a.tree.nodes[b];console.log(c.name+" -> "+(c.is_watered?"YES":"-"))}};